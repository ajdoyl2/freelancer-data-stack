# Dagster workspace configuration for the freelancer data stack
#
# This file configures the Dagster workspace and deployment settings
# for the freelancer data stack orchestration.

# Repository configuration
load_from:
  - python_module: orchestration.dagster.definitions

# Storage configuration
storage:
  postgres:
    postgres_url: 
      env: DAGSTER_POSTGRES_URL
  # Alternative: SQLite for development
  # sqlite:
  #   base_dir: /opt/dagster/storage

# Compute log storage
compute_logs:
  module: dagster_aws.s3.compute_log_manager
  class: S3ComputeLogManager
  config:
    bucket: 
      env: DAGSTER_COMPUTE_LOGS_BUCKET
    prefix: compute-logs
  # Alternative: Local storage for development
  # module: dagster.core.storage.local_compute_log_manager
  # class: LocalComputeLogManager
  # config:
  #   base_dir: /opt/dagster/compute_logs

# Event log storage (can be same as storage)
event_log_storage:
  postgres:
    postgres_url:
      env: DAGSTER_POSTGRES_URL

# Schedule storage
schedule_storage:
  postgres:
    postgres_url:
      env: DAGSTER_POSTGRES_URL

# Run launcher configuration
run_launcher:
  module: dagster_docker
  class: DockerRunLauncher
  config:
    env_vars:
      - DAGSTER_POSTGRES_URL
      - DATAHUB_GMS_URL
      - DATAHUB_GMS_TOKEN
      - AIRBYTE_HOST
      - AIRBYTE_PORT
      - AIRBYTE_CONNECTION_ID
      - DLT_PIPELINE_NAME
      - DLT_DESTINATION
      - DLT_DATASET_NAME
      - DBT_PROJECT_DIR
      - DBT_PROFILES_DIR
      - DBT_TARGET
      - GE_PROJECT_DIR
      - GE_CHECKPOINT_NAME
      - GITHUB_REPO
      - GITHUB_TOKEN
    network: freelancer-data-stack_default
    container_kwargs:
      volumes:
        - /opt/dagster/app:/app
        - /var/run/docker.sock:/var/run/docker.sock
  # Alternative: In-process launcher for development
  # module: dagster
  # class: DefaultRunLauncher

# Run coordinator configuration
run_coordinator:
  module: dagster.core.run_coordinator
  class: DefaultRunCoordinator
  config:
    max_concurrent_runs: 10

# Telemetry
telemetry:
  enabled: false

# Local artifact storage
local_artifact_storage:
  base_dir: /opt/dagster/storage

# Code server configuration
code_servers:
  - module_name: orchestration.dagster.definitions
    attribute: defs
